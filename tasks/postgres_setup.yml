- name: Drop in readymade postgres.conf
  copy:
    src: postgresql.conf-9.3
    dest: /etc/postgresql/9.3/main
    mode: "u=rw,g=r,o=r"
  sudo: yes
  #Restart service if invocation has changed:
  notify:
    - restart postgres

- name: Create postgres voeventdb user
  postgresql_user:
    name: "{{ voeventdb_rw_user }}"
    password: "{{ voeventdb_rw_user }}"
    role_attr_flags: "SUPERUSER" #NB must be superuser for successful q3c init.
  become: yes
  become_user: postgres

- name: Create postgres voeventdb read-only user
  postgresql_user:
    name: "{{voeventdb_ro_user}}"
    password: "{{voeventdb_ro_user}}"
  become: yes
  become_user: postgres

- name: Create default-database for voeventdb_owner  (simplifies login)
  postgresql_db:
    name: "{{ voeventdb_rw_user }}"
    login_user: "{{ voeventdb_rw_user }}"
  become: yes
  become_user: "{{ voeventdb_rw_user }}"


